%% ===================== 1. 系统架构概览 =====================
graph TD
  A[图书商城后台管理系统]
  A --> B[用户认证模块]
  A --> C[核心管理模块]
  C --> C1[用户管理]
  C --> C2[图书管理]
  C --> C3[分类管理]
  C --> C4[标签管理]
  C --> C5[群聊管理]
  A --> D[数据统计模块]
  A --> E[API接口模块]

%% %% ===================== 2. 用户登录流程 =====================
%% graph TD
%%   start[开始] --> 访问系统[用户访问系统]
%%   访问系统 --> 检查session{检查session是否存在}
%%   检查session -->|已登录| 跳转首页[跳转首页]
%%   检查session -->|未登录| 显示登录页[显示登录页面]
%%   显示登录页 --> 输入信息[用户输入用户名密码]
%%   输入信息 --> 验证信息{验证用户信息}
%%   验证信息 -->|失败| 显示错误[显示错误信息]
%%   验证信息 -->|成功| 检查权限{检查用户角色权限}
%%   检查权限 -->|普通用户| 无权限提示[提示无权限]
%%   检查权限 -->|管理员/员工| 设置session[设置session信息]
%%   设置session --> 跳转首页[跳转至系统首页]

%% %% ===================== 3. 用户管理模块流程 =====================
%% graph TD
%%   用户管理 --> 分类管理[用户分类管理]
%%   分类管理 --> 管理员管理[管理员用户管理]
%%   分类管理 --> 员工管理[员工用户管理]
%%   分类管理 --> 普通用户管理[普通用户管理]
  
%%   用户管理 --> 操作流程[用户操作流程]
%%   操作流程 --> 新增用户[新增用户]
%%   新增用户 --> 验证唯一[验证用户名唯一性 → 插入数据库 → 刷新列表]
%%   操作流程 --> 编辑用户[编辑用户]
%%   编辑用户 --> 管理员编辑[管理员：可编辑所有信息]
%%   编辑用户 --> 员工编辑[员工：只能修改自己密码]
%%   操作流程 --> 删除用户[删除用户]
%%   删除用户 --> 限制删除[不能删除当前登录用户]
  
%%   用户管理 --> 搜索分页[用户搜索与分页]
%%   搜索分页 --> 角色筛选[按角色筛选]
%%   搜索分页 --> 用户名搜索[按用户名搜索]
%%   搜索分页 --> 分页显示[分页显示]

%% %% ===================== 4. 图书管理模块流程 =====================
%% graph TD
%%   图书管理 --> 列表展示[图书列表展示]
%%   列表展示 --> 多条件搜索[支持多条件搜索]
%%   多条件搜索 --> 分类筛选[按分类筛选]
%%   多条件搜索 --> 状态筛选[按状态筛选]
%%   多条件搜索 --> 标题搜索[按标题搜索]
%%   多条件搜索 --> 作者搜索[按作者搜索]
%%   列表展示 --> 分页显示[分页显示]
  
%%   图书管理 --> 图书操作[图书操作流程]
%%   图书操作 --> 新增图书[新增图书]
%%   新增图书 --> 保存图书[填写完整信息 → 验证数据 → 保存数据库]
%%   图书操作 --> 编辑图书[编辑图书]
%%   编辑图书 --> 更新图书[加载图书信息 → 修改数据 → 更新数据库]
%%   图书操作 --> 删除图书[删除图书]
%%   删除图书 --> 确认删除[确认删除 → 删除记录]
%%   图书操作 --> 批量删除[批量删除]
%%   批量删除 --> 批量确认[选择多条记录 → 批量删除]
  
%%   图书管理 --> 状态管理[图书状态管理]
%%   状态管理 --> 上架下架[上架/下架切换]

%% %% ===================== 5. 分类管理模块流程 =====================
%% graph TD
%%   分类管理 --> 分类列表[分类列表展示]
%%   分类列表 --> 分类状态筛选[按状态筛选]
%%   分类列表 --> 分类名称搜索[按名称搜索]
%%   分类列表 --> 按排序显示[按排序显示]
  
%%   分类管理 --> 分类操作[分类操作流程]
%%   分类操作 --> 新增分类[新增分类]
%%   新增分类 --> 保存分类[输入分类信息 → 设置排序 → 保存]
%%   分类操作 --> 编辑分类[编辑分类]
%%   编辑分类 --> 更新分类[修改分类信息 → 更新数据库]
%%   分类操作 --> 删除分类[删除分类]
%%   删除分类 --> 级联删除[确认删除 → 级联删除相关图书]
  
%%   分类管理 --> 状态管理[分类状态管理]
%%   状态管理 --> 启用禁用[启用/禁用切换]

%% %% ===================== 6. 群聊管理模块流程 =====================
%% graph TD
%%   群聊管理 --> 群聊列表[群聊列表展示]
%%   群聊列表 --> 群聊多条件[多条件搜索]
%%   群聊多条件 --> 群名搜索[按群聊名称]
%%   群聊多条件 --> 群主搜索[按群主名称]
%%   群聊多条件 --> 成员数筛选[按最大成员数]
%%   群聊多条件 --> 群聊状态筛选[按状态筛选]
%%   群聊列表 --> 分页显示[分页显示]
  
%%   群聊管理 --> 群聊操作[群聊操作流程]
%%   群聊操作 --> 新增群聊[新增群聊]
%%   新增群聊 --> 保存群聊[设置群聊信息 → 选择群主 → 保存]
%%   群聊操作 --> 编辑群聊[编辑群聊]
%%   编辑群聊 --> 更新群聊[修改群聊信息 → 更新数据库]
%%   群聊操作 --> 删除群聊[删除群聊]
%%   删除群聊 --> 级联删除消息[确认删除 → 级联删除群聊消息]
  
%%   群聊管理 --> 状态管理[群聊状态管理]
%%   状态管理 --> 启用禁用[启用/禁用切换]

%% %% ===================== 7. 数据统计流程 =====================
%% graph TD
%%   首页统计[系统首页统计] --> 用户统计[用户统计]
%%   用户统计 --> 总用户[用户总数]
%%   用户统计 --> 今日新增[今日新增用户]
%%   用户统计 --> 本周新增[本周新增用户]
%%   用户统计 --> 本月新增[本月新增用户]
  
%%   首页统计 --> 图书统计[图书统计]
%%   图书统计 --> 总图书[图书总数]
%%   图书统计 --> 最新图书[最新图书列表]
  
%%   首页统计 --> 分类统计[分类统计]
%%   分类统计 --> 总分类[分类总数]
  
%%   首页统计 --> 群聊统计[群聊统计]
%%   群聊统计 --> 总群聊[群聊总数]

%% %% ===================== 8. 数据库关系图（ER图） =====================
%% erDiagram
%%   users {
%%     int id PK
%%     string username
%%     string password
%%     string role
%%     string status
%%   }
  
%%   categories {
%%     int id PK
%%     string name
%%     string status
%%   }
  
%%   books {
%%     int id PK
%%     string title
%%     string author
%%     int category_id FK
%%     float price
%%     int stock
%%     string status
%%   }
  
%%   tags {
%%     int id PK
%%     string name
%%   }
  
%%   book_tags {
%%     int book_id FK
%%     int tag_id FK
%%   }
  
%%   comments {
%%     int book_id FK
%%     int user_id FK
%%   }
  
%%   chat_groups {
%%     int id PK
%%     string group_name
%%     int group_owner_id FK
%%   }
  
%%   chat_messages {
%%     int id PK
%%     int group_id FK
%%     int user_id FK
%%   }
  
%%   books }|--|| categories : "属于"
%%   book_tags }|--|| books : "关联"
%%   book_tags }|--|| tags : "关联"
%%   comments }|--|| books : "评论"
%%   comments }|--|| users : "用户发布"
%%   chat_groups }|--|| users : "拥有"
%%   chat_messages }|--|| chat_groups : "包含"
%%   chat_messages }|--|| users : "发送"

%% %% ===================== 9. 权限控制流程 =====================
%% graph TD
%%   权限验证[权限验证流程] --> 访问页面[用户访问页面]
%%   访问页面 --> 检查session{检查session是否存在}
%%   检查session -->|不存在| 跳转登录[跳转登录页面]
%%   检查session -->|存在| 检查角色[检查用户角色]
  
%%   检查角色 --> 管理员[admin (管理员)]
%%   管理员 --> 所有权限[拥有所有权限]
  
%%   检查角色 --> 员工[员工]
%%   员工 --> 可访问权限[可访问：用户管理、图书管理、分类管理、群聊管理]
%%   员工 --> 限制权限[限制：只能编辑自己的用户信息]
  
%%   检查角色 --> 普通用户[用户]
%%   普通用户 --> 无权限[无后台访问权限]